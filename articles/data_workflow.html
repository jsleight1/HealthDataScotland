<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data workflow • HealthDataScotland</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="data_workflow_files/libs/quarto-html/popper.min.js"></script><script src="data_workflow_files/libs/quarto-html/tippy.umd.min.js"></script><link href="data_workflow_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="data_workflow_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">HealthDataScotland</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/HealthDataScotland.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_workflow.html">Data workflow</a></li>
    <li><a class="dropdown-item" href="../articles/health_unit.html">Introduction to health units</a></li>
    <li><a class="dropdown-item" href="../articles/map.html">Introduction to map units</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Data workflow</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jsleight1.github.io/HealthDataScotland/">HealthDataScotland</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The data used in HealthDataScotland is derived from a variety of sources on the NHS open data API, which is maintained by Public Health Scotland. This vignette will outlined exactly which sources are used and the workflow by which data is manipulated into a useable form by the application.</p>
</section><section class="section level2"><h2 id="data-sources">Data sources<a class="anchor" aria-label="anchor" href="#data-sources"></a>
</h2>
<p>Data is obtained from the following sources:</p>
<ul>
<li><a href="https://www.opendata.nhs.scot/dataset/gp-practice-contact-details-and-list-sizes" class="external-link">GP metadata</a></li>
<li><a href="https://www.opendata.nhs.scot/dataset/gp-practice-populations" class="external-link">GP demography data</a></li>
<li><a href="https://data.spatialhub.scot/dataset/gp_practices-is/resource/8389fd1d-563d-4c05-9833-26d9f07fd6cd" class="external-link">GP spatial data</a></li>
<li><a href="https://www.opendata.nhs.scot/dataset/hospital-codes" class="external-link">Hospital metadata</a></li>
<li><a href="https://www.opendata.nhs.scot/dataset/annual-hospital-beds-information" class="external-link">Hospital bed occupancy data</a></li>
<li><a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is/resource/b810d206-45bd-4dff-bac7-110a50b4bd3b" class="external-link">Hospital spatial data</a></li>
</ul></section><section class="section level2"><h2 id="data-workflow">Data workflow<a class="anchor" aria-label="anchor" href="#data-workflow"></a>
</h2>
<p>To aide with data transparency and reproducibility, I have outlined how the above data sets are retrieved and manipulated into a usable format by HealthDataScotland. The processed data set is stored in an Azure blob. This blob is updated periodically using a GitHub action.</p>
<section class="level2"><h3 id="gp-data-processing">GP data processing<a class="anchor" aria-label="anchor" href="#gp-data-processing"></a>
</h3>
<ul>
<li><p>GP metadata: GP metadata was obtained from the NHS open data set titled ‘gp-practice-contact-details-and-list-sizes’. This data set contains metadata for GP practice including name, address and phone number.</p></li>
<li><p>GP demography data: GP demographic data was obtained from the NHS open data set titled ‘gp-practice-populations’. This data set contains numbers of registered patients at each GP practice split by Gender and Age.</p></li>
<li><p>Combined data: The intersection of GP practice IDs between the metadata and demographic data was determined. This master set of IDs was used to combine the two data sets and this combined data set is used by the application.</p></li>
<li><p>Map: GP spatial data was derived from the Spatial Hub and manipulated into a format appropriate for visualisation. Please note the spatial data may be out of date and have missing information.</p></li>
<li><p>Summary: Unlike the interactive map, the ‘Summary’ section of the application uses the full combined GP data set derived from NHS open data. Therefore, demographic data for GP practices with missing spatial data can be viewed in this section. This section summarises GP demographic data at the national and health board level by grouping all GP practices within a particular group (e.g. the health board ‘Greater Glasgow and Clyde’) and summing the total number of registered patients. Please note that there may be unknown caveats with this approach. Therefore please refer to the published data sets before making any conclusions.</p></li>
</ul></section><section class="level2"><h3 id="hospital-data-processing">Hospital data processing<a class="anchor" aria-label="anchor" href="#hospital-data-processing"></a>
</h3>
<ul>
<li><p>Hospital metadata: Hospital metadata was obtained from the NHS open data set titled ‘hospital-codes’. This data set contains metadata for hospitals including name, address and health board.</p></li>
<li><p>Hospital bed occupancy data: Hospital bed occupancy data was obtained from the NHS open data set titled ‘annual-hospital-beds-information’. This data set was filtered to the PHS data set ID ‘d719af13-5fb3-430f-810e-ab3360961107’ to obtain bed capacity per specialty per hospital location.</p></li>
<li><p>Combined data: The intersection of hospital codes between the metadata and bed capactiy data was determined. This master set of IDs was used to combine the two data sets and this combined data set is used by the application.</p></li>
<li><p>Map: Hospital spatial data was derived from the Spatial Hub and manipulated into a format appropriate for visualisation. Please note the spatial data may be out of date and have missing information.</p></li>
<li><p>Summary: Unlike the interactive map, the ‘Summary’ section of the application uses the full combined hospital data set derived from NHS open data. Therefore bed capacity data for hospitals with missing spatial data can be viewed in this section. This section summarises hospital bed capacity data at the national and health board level per specialty by grouping all hospitals within a particular group (e.g. the health board ‘Greater Glasgow and Clyde’) and taking the average percentage bed occupancy for a selected specialty (whilst filering non-applicable data points). Please note that there may be unknown caveats with this approach. Therefore please refer to the published data sets before making any conclusions.</p></li>
</ul></section></section><section class="section level2"><h2 id="continuous-integration">Continuous integration<a class="anchor" aria-label="anchor" href="#continuous-integration"></a>
</h2>
<p>This data workflow creates a series of data.frames which are stored as an .RDS file in an Azure blob. This Azure blob is accessed when the shiny application launches. The data set is periodically updated every 6 months using a GitHub action.</p>
</section><section class="section level2"><h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p><span style="color: red">The workflows outlined provide a rough guide as to which public data sets are being used and how they are being manipulated. It is worth emphasising once more, however, that this application is primarily a hobby project. Therefore any decisions should not be made using the data without consulting the original published data sets.</span></p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jack Sleight.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
